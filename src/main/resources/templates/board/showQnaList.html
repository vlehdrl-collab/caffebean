<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<body>
  <section layout:fragment="content">
    <h2 class="qna_title">Q&A 목록</h2>

    <form th:action="@{/qna/search}" method="get" class="mb-3">
      <select name="searchType">
        <option value="title">제목</option>
        <option value="content">내용</option>
        <option value="writer">작성자</option>
        <option value="titleContent">제목+내용</option>
      </select>
      <input type="text" name="keyword" placeholder="검색어" />
      <button type="submit" class="btn btn-outline-secondary">검색</button>
      <a th:href="@{/qna}" class="btn btn-outline-dark">전체보기</a>
    </form>

    <table class="table">
      <thead>
        <tr>
          <th>번호</th>
          <th>제목</th>
          <th>작성자</th>
          <th>등록일</th>
          <th>조회수</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="qna : ${qnaPage.content}">
          <td th:text="${qna.id}"></td>
          <td><a th:href="@{/qna/{id}(id=${qna.id})}" th:text="${qna.title}"></a></td>
          <td th:text="${qna.writer}"></td>
          <td th:text="${#temporals.format(qna.createdDate, 'yyyy-MM-dd')}"></td>
          <td th:text="${qna.viewCount}"></td>
        </tr>
      </tbody>
    </table>

    <div>
      <a class="btn btn-primary" th:href="@{/qna/new}">새 질문 작성</a>
    </div>


    
    <!-- 검색 결과가 아닐 때 (기본 목록 페이징) -->
<nav aria-label="Page navigation" class="d-flex justify-content-center mt-4" th:if="${keyword == null or keyword.isEmpty()}">
  <ul class="pagination">
    <li class="page-item" th:classappend="${qnaPage.first} ? 'disabled'">
      <a class="page-link" th:href="@{/qna(page=0)}">처음</a>
    </li>
    <li class="page-item" th:classappend="${qnaPage.first} ? 'disabled'">
      <a class="page-link" th:href="@{/qna(page=${qnaPage.number - 1})}">이전</a>
    </li>

    <li class="page-item"
        th:each="i : ${#numbers.sequence(0, qnaPage.totalPages - 1)}"
        th:classappend="${i == qnaPage.number} ? 'active'">
      <a class="page-link" th:href="@{/qna(page=${i})}" th:text="${i + 1}">1</a>
    </li>

    <li class="page-item" th:classappend="${qnaPage.last} ? 'disabled'">
      <a class="page-link" th:href="@{/qna(page=${qnaPage.number + 1})}">다음</a>
    </li>
    <li class="page-item" th:classappend="${qnaPage.last} ? 'disabled'">
      <a class="page-link" th:href="@{/qna(page=${qnaPage.totalPages - 1})}">끝</a>
    </li>
  </ul>
</nav>

<!-- 검색 결과일 때 -->
<nav aria-label="Page navigation" class="d-flex justify-content-center mt-4" th:if="${keyword != null and !keyword.isEmpty()}">
  <ul class="pagination">
    <li class="page-item" th:classappend="${qnaPage.first} ? 'disabled'">
      <a class="page-link"
         th:href="@{/qna/search(page=0, searchType=${searchType}, keyword=${keyword})}">처음</a>
    </li>
    <li class="page-item" th:classappend="${qnaPage.first} ? 'disabled'">
      <a class="page-link"
         th:href="@{/qna/search(page=${qnaPage.number - 1}, searchType=${searchType}, keyword=${keyword})}">이전</a>
    </li>

    <li class="page-item"
        th:each="i : ${#numbers.sequence(0, qnaPage.totalPages - 1)}"
        th:classappend="${i == qnaPage.number} ? 'active'">
      <a class="page-link"
         th:href="@{/qna/search(page=${i}, searchType=${searchType}, keyword=${keyword})}"
         th:text="${i + 1}">1</a>
    </li>

    <li class="page-item" th:classappend="${qnaPage.last} ? 'disabled'">
      <a class="page-link"
         th:href="@{/qna/search(page=${qnaPage.number + 1}, searchType=${searchType}, keyword=${keyword})}">다음</a>
    </li>
    <li class="page-item" th:classappend="${qnaPage.last} ? 'disabled'">
      <a class="page-link"
         th:href="@{/qna/search(page=${qnaPage.totalPages - 1}, searchType=${searchType}, keyword=${keyword})}">끝</a>
    </li>
  </ul>
</nav>

  </section>
</body>
</html>